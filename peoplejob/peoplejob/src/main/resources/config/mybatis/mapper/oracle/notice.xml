<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="config.mybatis.mapper.oracle.notice">
<insert id="insertNotice" parameterType="noticeVo">
		<selectKey resultType="int" keyProperty="notifyCode" order="BEFORE">
			select notice_seq.nextval from dual
		</selectKey>
		insert into notice(notifyCode, notifytitle, notifycontent, adminCode) 
		values(#{notifyCode}, #{notifytitle}, #{notifycontent}, #{adminCode})
	</insert>

	
	<select id="selectSearch" parameterType="searchVo" resultType="boardVo">
		select *
		from
		(
		    select A.*, rownum as RNUM 
		    from
		    (
		        select notifyCode, notifytitle, notifycontent, readcount,notifydate,
					(sysdate-notifydate)*24 as new_Img_Term
				from notice		
				<if test="searchKeyword != null and searchKeyword != ''">
					where ${searchCondition} like '%' || #{searchKeyword} || '%'
				</if>		
				order by notifyCode desc
		    ) A
		)
		<![CDATA[ where RNUM>#{firstRecordIndex}  
		and RNUM<=#{firstRecordIndex} + #{recordCountPerPage}]]>
	</select>
	 
	 <select id="selectTotalCount" parameterType="searchVo" resultType="int">
	 select count(*) from notice
	 <if test="searchKeyword != null and searchKeyword !=''">
	 	where ${searchCondition} like '%' || #{searchKeyword} || '%'
	 </if>
	 </select>
	
	 
<update id="updateReadCount" parameterType="int">
		update notice
		set readcount=readcount+1 
		where notifyCode=#{notifyCode}
	</update>
	 
</mapper>









