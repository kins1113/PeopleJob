<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="config.mybatis.mapper.oracle.resume">
	
	<insert id="insertMember2" parameterType="resumeVo">
		<selectKey keyProperty="memberCode" order="BEFORE" resultType="int">
			select member_seq.nextval from dual
		</selectKey>
	insert into member(member_code, membername, zipcode, address, addressdetail, birth, membergender, email, tel)
	values(#{memberCode},  #{membername},#{zipcode},#{address},#{addressdetail}, 
	#{birth},#{membergender},#{email},#{tel})
	</insert>	
		
	<insert id="insertResume" parameterType="resumeVo">
		<selectKey order="BEFORE" keyProperty="resumeCode" resultType="int">
		select resume_seq.nextval from dual
		</selectKey>
		insert into resume(resume_code,resumetitle,resumeregdate,introduce,award,langlicence_code,licence_code,dv_code,academic_code,desiredwork_code,opencheck,member_code,picture)
		values(#{resumeCode},#{resumetitle},sysdate,#{introduce},#{award},#{langlicenceCode},#{licenceCode},#{dvCode},#{academicCode},#{desiredworkCode},#{opencheck},#{memberCode},#{picture})
	</insert>
	
	<insert id="insertLangcertification" parameterType="resumeVo">
		<selectKey order="BEFORE" keyProperty="langlicenceCode" resultType="int">
		select langcertification_seq.nextval from dual
		</selectKey>
		insert into langcertification(langlicence_code,langlicencename,lang_getdate,institute,certificationtype,language,langpoint,lang_grade)
		values(#{langlicenceCode},#{langlicencename},#{langGetdate},#{institute},#{certificationtype},#{language},#{langpoint},#{langGrade})
	</insert>    
	
	<insert id="insertCertificate" parameterType="resumeVo">
		<selectKey order="BEFORE" keyProperty="lNo" resultType="int">
		select certificate_seq.nextval from dual
		</selectKey>
		insert into certificate(l_no,l_name,l_getdate,l_institution)
		values(#{lNo},#{lName},#{lGetdate},#{lInstitute})
	</insert>
	
	<insert id="insertCareer" parameterType="resumeVo">
		<selectKey order="BEFORE" keyProperty="dvCode" resultType="int">
		select career_seq.nextval from dual
		</selectKey>
		insert into career
		values(#{dvCode},#{companyname},#{workterm},#{chargework},#{workcheck},#{jobgrade},#{jobgrade},#{workcondition})
		
	</insert>
	
	<insert id="insertEducation" parameterType="resumeVo">
		<selectKey order="BEFORE" keyProperty="academicCode" resultType="int">
		select education_seq.nextval from dual
		</selectKey>
		insert into education
		values(#{academicCode},#{schoolname},#{major},#{degree},#{graduate},#{graduatecheck},#{schoollocal},#{graduatetype})
		
	</insert>
	
	<insert id="insertHopeWorking" parameterType="resumeVo">
		<selectKey order="BEFORE" keyProperty="hopeworkCode" resultType="int">
		select hope_working_seq.nextval from dual
		</selectKey>
		insert into hope_working 
		values(#{hopeworkCode},#{jobtype},#{hopepay},#{hopeworkform},#{localCode},#{firstjobCode},#{schoollocal},#{hopeworkdate})
		
	</insert>
	
	<insert id="insertLocation" parameterType="resumeVo">
		<selectKey order="BEFORE" keyProperty="localCode" resultType="int">
		select location_seq.nextval from dual
		</selectKey>
		insert into location
		values(#{localCode},#{sido},#{gugun})
		
	</insert>
	
	<insert id="insertFirst" parameterType="resumeVo">
		<selectKey order="BEFORE" keyProperty="firstCode" resultType="int">
		select first_seq.nextval from dual
		</selectKey>
		insert into first
		values(#{firstCode},#{firstname},#{secondCode})
		
	</insert>
	
	<insert id="insertSecond" parameterType="resumeVo">
		<selectKey order="BEFORE" keyProperty="secondCode" resultType="int">
		select second_seq.nextval from dual
		</selectKey>
		insert into second
		values(#{secondCode},#{secondname},#{thirdCode})
		
	</insert>
	<insert id="insertThird" parameterType="resumeVo">
		<selectKey order="BEFORE" keyProperty="thirdCode" resultType="int">
		select third_seq.nextval from dual
		</selectKey>
		insert into third
		values(#{thirdCode},#{thirdname})
		
	</insert>
	<select id="selectSearch" parameterType="searchVo" resultType="resumeVo">
		select *
		from
		(
		    select A.*, rownum as RNUM 
		    from
		    (
		        select memberid,(sysdate-regdate)*24 as new_Img_Term, membername, zipcode, address,addressdetail,member_code,withdrawaldate,pwd,birth,membergender,email,tel,authority_code
					
				from member		
				<if test="searchKeyword != null and searchKeyword != ''">
					where ${searchCondition} like '%' || #{searchKeyword} || '%'
				</if>		
				order by resume_code desc
		    ) A
		)
		<![CDATA[ where RNUM>#{firstRecordIndex}  
		and RNUM<=#{firstRecordIndex} + #{recordCountPerPage}]]>
	</select>
	
	<select id="selectByMemverid" parameterType="string" resultType="resumeVo">
		select * from member where memberid=#{memberid}
	</select>
	
		<select id="selectResumeByNo" resultType="resumeVo" parameterType="int">
		select resume_code, resumetitle, introduce, award, opencheck, langlicencename,lang_getdate,
    	institute,companyname,workterm,chargework,l_name,l_getdate,l_institution,
    	schoolname,major,degree,graduate,graduatecheck,jobtype,hopeworkdate,hopepay,
    	hopeworkform,memberid,membername,zipcode,address,addressdetail,birth,
    	membergender,email,picture,tel,sido,gugun,firstname,secondname,thirdname

		from resume r,langcertification la,career ca,
    	certificate ce,education ed,Hope_working ho,
    	member m,location lo,first f,second s ,third t

		where r.langlicence_code=la.langlicence_code and r.LICENCE_CODE=ce.L_NO and 
    	r.DV_CODE = ca.DV_CODE and r.ACADEMIC_CODE=ed.ACADEMIC_CODE and 
    	r.DESIREDWORK_CODE=ho.HOPEWORK_CODE and m.MEMBER_CODE = r.MEMBER_CODE and 
    	ho.LOCAL_CODE=lo.LOCAL_CODE and ho.FIRSTJOB_CODE=f.FIRST_CODE and 
    	f.SECOND_CODE = s.SECOND_CODE and s.THIRD_CODE = t.THIRD_CODE and resume_code=#{resumeCode}
	</select>
		
		<delete id="deleteResumeByNo" parameterType="int">
		delete from resume where resume_code=#{resumeCode}
		</delete>
		
		<update id="updateResume" parameterType="resumeVo">
		update (select resume_code, resumetitle, introduce, award, opencheck, langlicencename,lang_getdate,
    	institute,companyname,workterm,chargework,l_name,l_getdate,l_institution,
    	schoolname,major,degree,graduate,graduatecheck,jobtype,hopeworkdate,hopepay,
    	hopeworkform,memberid,membername,zipcode,address,addressdetail,birth,
    	membergender,email,picture,tel,sido,gugun,firstname,secondname,thirdname

		from resume r,langcertification la,career ca,
    	certificate ce,education ed,Hope_working ho,
    	member m,location lo,first f,second s ,third t

		where r.langlicence_code=la.langlicence_code and r.LICENCE_CODE=ce.L_NO and 
    	r.DV_CODE = ca.DV_CODE and r.ACADEMIC_CODE=ed.ACADEMIC_CODE and 
    	r.DESIREDWORK_CODE=ho.HOPEWORK_CODE and m.MEMBER_CODE = r.MEMBER_CODE and 
    	ho.LOCAL_CODE=lo.LOCAL_CODE and ho.FIRSTJOB_CODE=f.FIRST_CODE and 
    	f.SECOND_CODE = s.SECOND_CODE and s.THIRD_CODE = t.THIRD_CODE)
    	
		set resumeTitle=#{resumeTitle},introduce=#{introduce},award=#{award},opencheck=#{opencheck},langlicencename=#{langlicencename},
		lang_getdate=#{langGetdate},institute=#{institute},companyname=#{companyname},workterm=#{workterm},chargework=#{chargework},l_name=#{lName},l_getdate=#{lGetdate},l_institution=#{lInstitution},
    	schoolname=#{schoolname},major=#{major},degree=#{degree},graduate=#{graduate},graduatecheck=#{graduatecheck},jobtype=#{jobtype},hopeworkdate=#{hopeworkdate},hopepay=#{hopepay},
    	hopeworkform=#{hopeworkform},zipcode=#{zipcode},address=#{address},addressdetail=#{addressdetail},
    	email=#{email},picture=#{picture},tel=#{tel},sido=#{sido},gugun=#{gugun},firstname=#{firstname},secondname=#{secondname},thirdname=#{thirdname}
			 
		where resume_code=#{resumeCode}
	</update>
	
	<!-- <insert id="insertResume" parameterType="resumeVo">
		<selectKey order="BEFORE" keyProperty="resumeCode,langlicenceCode,dvCode,licenceCode,academicCode,desiredworkCode,memberCode" resultType="hashmap">
			select resume_seq.nextval as resumeCode, langcertification_seq.nextval as langlicenceCode
			,career_seq.nextval as dvCode,  certification_seq.nextval as licenceCode,
			education_seq.nextval as academicCode,
			hopeWorking_seq.nextval as desiredworkCode, member_seq.nextval as memberCode from dual
		</selectKey>
	
		insert into resume

		values(#{resumeCode},#{resumeTitle},sysdate,#{introduce},#{award},#{langlicenceCode},#{licenceCode},#{dvCode},#{academicCode},#{desiredworkCode},#{opencheck},#{memberCode})
		</insert>  -->
		
	<!-- <insert id="insertResume" parameterType="resumeVo">
		insert into resume
		(select resume_code, resumetitle, introduce, award, opencheck, langlicencename,lang_getdate,
    institute,companyname,workterm,chargework,l_name,l_getdate,l_institution,
    schoolname,major,degree,graduate,graduatecheck,jobtype,hopeworkdate,hopepay,
    hopeworkform,memberid,membername,zipcode,address,addressdetail,birth,
    membergender,email,picture,tel,sido,gugun,firstname,secondname,thirdname

	from resume r,langcertification la,career ca,
    certificate ce,education ed,Hope_working ho,
    member m,location lo,first f,second s ,third t

	where r.langlicence_code=la.langlicence_code and r.LICENCE_CODE=ce.L_NO and 
    r.DV_CODE = ca.DV_CODE and r.ACADEMIC_CODE=ed.ACADEMIC_CODE and 
    r.DESIREDWORK_CODE=ho.HOPEWORK_CODE and m.MEMBER_CODE = r.MEMBER_CODE and 
    ho.LOCAL_CODE=lo.LOCAL_CODE and ho.FIRSTJOB_CODE=f.FIRST_CODE and 
    f.SECOND_CODE = s.SECOND_CODE and s.THIRD_CODE = t.THIRD_CODE)
	values(RESUME_SEQ.nextval,'이력서','자기소개','경시대회은상','Y','컴퓨터활용',
    	sysdate,'큐넷','율무',sysdate,'직무','아무',sysdate,'기관','서울대','국어국문학과','국문학사',
   	 	sysdate,'학사졸업','정규직',sysdate,'5000만원','정규직','ghghtls','이길동','280-521','서울','서울 상세',
    	sysdate,'남','ghghtls@naver.com','사진','010-8815-4567','서울','마포구','외식업','중식','중식업');
    </insert> -->
   <!--  <insert id="insertResume" parameterType="resumeVo">
		<selectKey order="BEFORE" keyProperty="resumeCode,langlicenceCode,dvCode,lNo,hopeworkCode,memberCode,localCode,academicCode,firstCode,secondCode,thirdCode" resultType="hashmap">
			select resume_seq.nextval as resumeCode, langcertification_seq.nextval as langlicenceCode
			,career_seq.nextval as dvCode,certificate_seq.nextval as lNo,  
			 Hope_working_seq.nextval as hopeworkCode,member_seq.nextval as memberCode, location_seq.nextval as localCode,education_seq.nextval as academicCode,
			 first_seq.nextval as firstCode,second_seq.nextval as secondCode,third_seq.nextval as thirdCode from dual
		</selectKey>
	
		
		insert all INTO resume(resumeCode,resumeTitle,introduce,award,opencheck)

		VALUES (#{resumeCode},#{resumeTitle},#{introduce},#{award},#{opencheck})

		INTO langcertification (langlicenceCode,langlicencename,langGetdate,institute,certificationtype,language,langpoint,langGrade)

		VALUES (#{langlicenceCode},#{langlicencename},#{langGetdate},#{institute},#{certificationtype},#{language},#{langpoint},#{langGrade})

		INTO career (dvCode,companyname,workterm,chargework,workcheck,jobgrade,workcondition)

		VALUES (#{dvCode},#{companyname},#{workterm},#{chargework},#{workcheck},#{jobgrade},#{workcondition})

		INTO certificate (lNo,lName,lGetdate,lInstitution)

		VALUES (#{lNo},#{lName},#{lGetdate},#{lInstitution})

		INTO Hope_working (hopeworkCode,jobtype,hopeworkdate,hopepay,hopeworkform)
		VALUES (#{hopeworkCode},#{jobtype},#{hopeworkdate},#{hopepay},#{hopeworkform})

		into member(memberid,membername,zipcode,address,addressdetail,memberCode,pwd,birth,membergender,email,picture,tel)
		values(#{memberid},#{membername},#{zipcode},#{address},#{addressdetail},#{memberCode},#{pwd},#{birth},#{membergender},#{eamil},#{picture},#{tel})

		into location(localCode,sido,gugun)
		values(#{localCode},#{sido},#{gugun})
		
		into education(academicCode,schoolname,major,degree,graduate,graduatecheck,schoollocal,graduatetype)
		values(#{academicCode},#{schoolname},#{major},#{degree},#{graduate},#{graduatecheck},#{schoollocal},#{graduatetype})
		
		into first(firstCode,firstname)
		values(#{firstCode},#{firstname})

		into second(secondCode,secondname)
		values(#{secondCode},#{secondname})

		into third(thirdCode,thirdname)
		values(#{thirdCode},#{thirdname})

		select * from dual
	</insert>   -->
</mapper>









